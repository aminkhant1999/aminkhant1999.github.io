<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Snake ‚Äî HTML5 Canvas</title>
<style>
  :root { --bg:#0b1220; --panel:#0f172a; --grid:#0e1a2b; --snake:#22c55e; --head:#16a34a; --food:#f97316; --text:#e5e7eb; --muted:#93a3b8; --accent:#38bdf8; }
  * { box-sizing: border-box; }
  body {
    margin: 0; min-height: 100vh; display: grid; place-items: center;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
    background: radial-gradient(1200px 700px at 70% -10%, #162036, var(--bg));
    color: var(--text);
  }
  .wrap {
    width: min(640px, 94vw);
    background: linear-gradient(180deg, var(--panel), #0a1324);
    border: 1px solid #1a2336; border-radius: 16px; padding: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  header {
    display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
    margin-bottom: 10px;
  }
  h1 { font-size: clamp(20px, 3.5vw, 28px); margin: 0; letter-spacing:.3px; }
  .stats { display:flex; gap:12px; flex-wrap:wrap; }
  .badge {
    background:#0d192d; border:1px solid #1e2a41; padding:8px 10px; border-radius:10px;
    font-weight:700; font-size:14px;
  }
  .badge small { display:block; color:var(--muted); font-weight:500; font-size:11px; }
  .board {
    background: var(--grid); border:1px solid #1e2a41; border-radius:12px; padding:10px;
  }
  canvas { display:block; width:100%; height:auto; border-radius:8px; background:#0b1324; }
  .panel {
    display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:10px; flex-wrap:wrap;
  }
  .controls { display:flex; gap:8px; flex-wrap:wrap; }
  button {
    background:#122036; color:var(--text); border:1px solid #263650;
    padding:10px 12px; border-radius:10px; cursor:pointer; transition: background .2s, transform .08s, border-color .2s;
    font-size:14px;
  }
  button:hover { background:#162745; border-color:#38557b; }
  button:active { transform: translateY(1px); }
  .hint { color:var(--muted); font-size:12px; text-align:center; margin-top:8px; }
  /* On-screen D-pad for touch */
  .dpad {
    display: grid; grid-template-areas: ". up ." "left . right" ". down .";
    gap: 6px; margin-left:auto;
  }
  .dpad button { width:46px; height:46px; padding:0; }
  .dpad .up { grid-area: up; }
  .dpad .down { grid-area: down; }
  .dpad .left { grid-area: left; }
  .dpad .right { grid-area: right; }
  @media (max-width: 420px) {
    .dpad button { width:42px; height:42px; }
  }
</style>
</head>
<body>
  <div class="wrap" aria-live="polite">
    <header>
      <h1>üêç Snake</h1>
      <div class="stats">
        <div class="badge"><small>Score</small><span id="score">0</span></div>
        <div class="badge"><small>High</small><span id="high">0</span></div>
        <div class="badge"><small>Speed</small>
          <select id="speed" aria-label="Speed">
            <option value="8">Slow</option>
            <option value="12" selected>Normal</option>
            <option value="16">Fast</option>
            <option value="22">Insane</option>
          </select>
        </div>
      </div>
    </header>

    <div class="board">
      <canvas id="canvas" width="400" height="400" aria-label="Snake game area"></canvas>
    </div>

    <div class="panel">
      <div class="controls">
        <button id="btn-start">Start</button>
        <button id="btn-pause">Pause</button>
        <button id="btn-restart">Restart</button>
      </div>
      <div class="dpad" aria-label="Touch controls">
        <button class="up" data-dir="up" aria-label="Up">‚¨ÜÔ∏è</button>
        <button class="left" data-dir="left" aria-label="Left">‚¨ÖÔ∏è</button>
        <button class="right" data-dir="right" aria-label="Right">‚û°Ô∏è</button>
        <button class="down" data-dir="down" aria-label="Down">‚¨áÔ∏è</button>
      </div>
    </div>

    <div class="hint">Controls: Arrow keys / WASD ‚Ä¢ Pause: Space ‚Ä¢ Restart: R</div>
  </div>

<script>
(() => {
  // ----- Config -----
  const GRID = 20;              // grid size (20x20)
  const TILE = 20;              // px per cell (canvas base size 400x400)
  const CANVAS_BASE = GRID * TILE;
  const SNAKE_COLOR = getCSS('--snake') || '#22c55e';
  const HEAD_COLOR  = getCSS('--head')  || '#16a34a';
  const FOOD_COLOR  = getCSS('--food')  || '#f97316';

  // ----- DOM -----
  const canvas  = document.getElementById('canvas');
  const ctx     = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const highEl  = document.getElementById('high');
  const speedEl = document.getElementById('speed');
  const btnStart= document.getElementById('btn-start');
  const btnPause= document.getElementById('btn-pause');
  const btnRestart=document.getElementById('btn-restart');

  // HiDPI crispness
  function setupHiDPI() {
    const dpr = window.devicePixelRatio || 1;
    canvas.width  = CANVAS_BASE * dpr;
    canvas.height = CANVAS_BASE * dpr;
    canvas.style.width  = CANVAS_BASE + 'px';
    canvas.style.height = CANVAS_BASE + 'px';
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }
  setupHiDPI();
  window.addEventListener('resize', setupHiDPI);

  // ----- Game State -----
  let snake, dir, queuedDir, food, score, high, running, lastTime, acc, step, gameOver;

  // Target steps per second = speed; we compute ms per step
  function setSpeed(spd) { step = 1000 / spd; }

  // Initialize / Reset state
  function reset() {
    snake = [{x:10, y:10},{x:9,y:10},{x:8,y:10}]; // start mid
    dir = {x:1, y:0}; queuedDir = {x:1, y:0};
    food = spawnFood();
    score = 0; gameOver = false;
    acc = 0; lastTime = performance.now();
    setSpeed(parseInt(speedEl.value, 10));
    scoreEl.textContent = score;
    high = parseInt(localStorage.getItem('snake_high') || '0', 10);
    highEl.textContent = high;
    draw(); // immediate draw
  }

  function spawnFood() {
    let pos;
    do {
      pos = { x: randInt(0, GRID-1), y: randInt(0, GRID-1) };
    } while (snake.some(s => s.x === pos.x && s.y === pos.y));
    return pos;
  }

  function randInt(min, max) { // inclusive
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  // ----- Input -----
  function queueDir(nx, ny) {
    // prevent reversing directly
    if (nx === -dir.x && ny === -dir.y) return;
    queuedDir = {x:nx, y:ny};
  }
  window.addEventListener('keydown', e => {
    const k = e.key.toLowerCase();
    if (k === 'arrowup' || k === 'w') queueDir(0,-1);
    else if (k === 'arrowdown' || k === 's') queueDir(0,1);
    else if (k === 'arrowleft' || k === 'a') queueDir(-1,0);
    else if (k === 'arrowright' || k === 'd') queueDir(1,0);
    else if (k === ' '){ togglePause(); }
    else if (k === 'r'){ hardRestart(); }
  });

  document.querySelectorAll('.dpad button').forEach(btn => {
    btn.addEventListener('click', () => {
      const d = btn.dataset.dir;
      if (d==='up') queueDir(0,-1);
      if (d==='down') queueDir(0,1);
      if (d==='left') queueDir(-1,0);
      if (d==='right') queueDir(1,0);
    });
  });

  btnStart.addEventListener('click', start);
  btnPause.addEventListener('click', togglePause);
  btnRestart.addEventListener('click', hardRestart);
  speedEl.addEventListener('change', () => setSpeed(parseInt(speedEl.value,10)));

  // ----- Loop -----
  function start() {
    if (running && !gameOver) return;
    running = true; gameOver = false;
    lastTime = performance.now(); acc = 0;
    requestAnimationFrame(loop);
  }
  function togglePause() {
    if (gameOver) return;
    running = !running;
    if (running) {
      lastTime = performance.now(); acc = 0;
      requestAnimationFrame(loop);
    } else {
      drawBanner('Paused ‚Äî press Space to resume');
    }
  }
  function hardRestart() { reset(); start(); }

  function loop(t) {
    if (!running) return;
    const dt = t - lastTime;
    lastTime = t;
    acc += dt;

    // Progress in fixed steps (grid movement)
    while (acc >= step) {
      update();
      acc -= step;
      if (gameOver) { running = false; break; }
    }
    draw();
    if (running) requestAnimationFrame(loop);
  }

  // ----- Update -----
  function update() {
    // apply queued direction at step boundary
    dir = queuedDir;

    // next head position
    const head = snake[0];
    const nx = head.x + dir.x;
    const ny = head.y + dir.y;

    // wall collision
    if (nx < 0 || ny < 0 || nx >= GRID || ny >= GRID) { return endGame(); }
    // self collision
    if (snake.some((s,i) => i>0 && s.x===nx && s.y===ny)) { return endGame(); }

    // move: add new head
    snake.unshift({x:nx, y:ny});

    // food?
    if (nx === food.x && ny === food.y) {
      score += 1;
      scoreEl.textContent = score;
      if (score > high) { high = score; highEl.textContent = high; localStorage.setItem('snake_high', String(high)); }
      food = spawnFood();
    } else {
      // trim tail (no growth)
      snake.pop();
    }
  }

  function endGame() {
    gameOver = true;
    draw(); // final frame
    drawBanner('üíÄ Game Over ‚Äî press R to restart');
  }

  // ----- Render -----
  function draw() {
    // clear
    ctx.fillStyle = '#081021';
    ctx.fillRect(0,0, CANVAS_BASE, CANVAS_BASE);

    // draw grid (subtle)
    ctx.strokeStyle = 'rgba(255,255,255,0.045)';
    ctx.lineWidth = 1;
    for (let i=1;i<GRID;i++){
      const p = i*TILE;
      ctx.beginPath(); ctx.moveTo(p,0); ctx.lineTo(p,CANVAS_BASE); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(0,p); ctx.lineTo(CANVAS_BASE,p); ctx.stroke();
    }

    // food
    drawCell(food.x, food.y, FOOD_COLOR, 6);

    // snake
    snake.forEach((seg, idx) => {
      const color = idx === 0 ? HEAD_COLOR : SNAKE_COLOR;
      drawCell(seg.x, seg.y, color, idx === 0 ? 3 : 4);
    });
  }

  function drawCell(x, y, color, inset=4) {
    const px = x*TILE, py = y*TILE;
    ctx.fillStyle = color;
    const r = 6; // rounded rect
    roundRect(ctx, px+inset, py+inset, TILE-2*inset, TILE-2*inset, r);
    ctx.fill();
  }

  function roundRect(ctx, x, y, w, h, r=6) {
    ctx.beginPath();
    ctx.moveTo(x+r, y);
    ctx.arcTo(x+w, y, x+w, y+h, r);
    ctx.arcTo(x+w, y+h, x, y+h, r);
    ctx.arcTo(x, y+h, x, y, r);
    ctx.arcTo(x, y, x+w, y, r);
    ctx.closePath();
  }

  function drawBanner(text) {
    // overlay banner
    ctx.save();
    ctx.fillStyle = 'rgba(0,0,0,0.45)';
    ctx.fillRect(0, CANVAS_BASE/2 - 36, CANVAS_BASE, 72);
    ctx.fillStyle = '#e5e7eb';
    ctx.font = '16px system-ui, -apple-system, Segoe UI, Roboto, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(text, CANVAS_BASE/2, CANVAS_BASE/2 + 5);
    ctx.restore();
  }

  function getCSS(varName) {
    return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
  }

  // Boot
  reset();
})();
</script>
</body>
</html>
