<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Snake ‚Äî HTML5 Canvas</title>
<style>
  :root { --bg:#0b1220; --panel:#0f172a; --grid:#0e1a2b; --snake:#22c55e; --head:#16a34a; --food:#f97316; --text:#e5e7eb; --muted:#93a3b8; }
  * { box-sizing: border-box; }
  body {
    margin: 0; min-height: 100vh; display: grid; place-items: center;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
    background: radial-gradient(1200px 700px at 70% -10%, #162036, var(--bg));
    color: var(--text);
  }
  .wrap {
    width: min(680px, 94vw);
    background: linear-gradient(180deg, var(--panel), #0a1324);
    border: 1px solid #1a2336; border-radius: 16px; padding: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  header {
    display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
    margin-bottom: 10px;
  }
  h1 { font-size: clamp(20px, 3.5vw, 28px); margin: 0; letter-spacing:.3px; }
  .stats { display:flex; gap:12px; flex-wrap:wrap; }
  .badge {
    background:#0d192d; border:1px solid #1e2a41; padding:8px 10px; border-radius:10px;
    font-weight:700; font-size:14px;
  }
  .badge small { display:block; color:var(--muted); font-weight:500; font-size:11px; }
  .board {
    background: var(--grid); border:1px solid #1e2a41; border-radius:12px; padding:10px;
    touch-action: none; /* allow swipe & tap without page scroll */
  }
  canvas { display:block; width:100%; height:auto; border-radius:8px; background:#0b1324; }
  .panel { display:flex; justify-content:space-between; align-items:center; margin-top:10px; flex-wrap:wrap; }
  .controls { display:flex; gap:8px; flex-wrap:wrap; }
  .btn {
    background:#122036; color:var(--text); border:1px solid #263650;
    padding:10px 12px; border-radius:10px; cursor:pointer; transition: background .2s, transform .08s, border-color .2s;
    font-size:14px; text-decoration:none;
  }
  .btn:hover { background:#162745; border-color:#38557b; }
  .hint { color:var(--muted); font-size:12px; text-align:center; margin-top:8px; }

  dialog {
    border:none; border-radius:14px; width:min(560px,92vw);
    background: linear-gradient(180deg, var(--panel), #0b1324);
    color:var(--text); padding:0; box-shadow:0 20px 60px rgba(0,0,0,.55);
    border:1px solid #1e2a41;
  }
  .dlg-head { padding:14px 16px; border-bottom:1px solid #1e2a41; font-weight:700; }
  .dlg-body { padding:14px 16px; color:#cfd6e6; font-size:14px; line-height:1.5; }
  .dlg-actions { padding:12px 16px; border-top:1px solid #1e2a41; display:flex; justify-content:flex-end; }
  dialog::backdrop { background: rgba(0,0,0,.55); }
</style>
</head>
<body>
  <div class="wrap" aria-live="polite">
    <header>
      <h1>üêç Snake</h1>
      <div class="stats">
        <div class="badge"><small>Score</small><span id="score">0</span></div>
        <div class="badge"><small>High</small><span id="high">0</span></div>
        <div class="badge"><small>Speed</small>
          <select id="speed" aria-label="Speed">
            <option value="8">Slow</option>
            <option value="12" selected>Normal</option>
            <option value="16">Fast</option>
            <option value="22">Insane</option>
          </select>
        </div>
      </div>
    </header>

    <div class="board" id="board">
      <canvas id="canvas" width="400" height="400" aria-label="Snake game area"></canvas>
    </div>

    <div class="panel">
      <div class="controls">
        <button class="btn" id="btn-help">Instructions</button>
        <a href="../index.html" class="btn" id="btn-home">üè† Back to Home</a>
      </div>
    </div>


    <div class="hint">
      Controls: <strong>W/A/S/D</strong> ‚Ä¢ Pause/Play: <strong>F</strong> ‚Ä¢ Restart: <strong>R</strong> ‚Ä¢
      Touch: <strong>Swipe</strong>=move, <strong>Tap</strong>=pause/play (alive), <strong>Double-tap</strong>=restart (alive), <strong>Tap</strong>=restart (dead)
    </div>
  </div>

  <!-- Instructions dialog -->
  <dialog id="helpDlg" aria-labelledby="helpTitle">
    <div class="dlg-head" id="helpTitle">Snake ‚Äî Instructions</div>
    <div class="dlg-body">
      <p><strong>Goal:</strong> Eat food to grow longer. Don‚Äôt hit the walls or your own body.</p>
      <p><strong>Keyboard (Desktop):</strong><br>
        Move: <code>W</code>/<code>A</code>/<code>S</code>/<code>D</code> (arrows disabled)<br>
        Pause/Play: <code>F</code><br>
        Restart: <code>R</code>
      </p>
      <p><strong>Touch (Mobile/Tablet):</strong><br>
        Swipe to move.<br>
        <em>When alive:</em> Single tap = pause/play; double-tap = restart.<br>
        <em>When dead:</em> Single tap = restart.</p>
      <p><strong>Tips:</strong> Plan turns early and avoid boxing yourself in. Adjust speed for difficulty.</p>
    </div>
    <div class="dlg-actions">
      <button class="btn" id="btn-close-help">Close</button>
    </div>
  </dialog>

<script>
(() => {
  const GRID = 20;
  let TILE = 20;
  let CANVAS_CSS = GRID * TILE;

  const SNAKE_COLOR = getCSS('--snake');
  const HEAD_COLOR  = getCSS('--head');
  const FOOD_COLOR  = getCSS('--food');

  const board = document.getElementById('board');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const highEl = document.getElementById('high');
  const speedEl = document.getElementById('speed');
  const btnHelp = document.getElementById('btn-help');
  const helpDlg = document.getElementById('helpDlg');
  const btnCloseHelp = document.getElementById('btn-close-help');

  let snake, dir, queuedDir, food, score, high, running, lastTime, acc, step, gameOver, hasStarted;
  let rafStarted = false;

  function resizeCanvas() {
    const cssSide = Math.floor(board.clientWidth - 20);
    CANVAS_CSS = Math.max(140, cssSide);
    canvas.style.width = CANVAS_CSS + 'px';
    canvas.style.height = CANVAS_CSS + 'px';
    const dpr = window.devicePixelRatio || 1;
    canvas.width = Math.floor(CANVAS_CSS * dpr);
    canvas.height = Math.floor(CANVAS_CSS * dpr);
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    TILE = Math.floor(CANVAS_CSS / GRID);
  }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  function setSpeed(spd) { step = 1000 / spd; }

  function reset() {
    snake = [{x:10,y:10},{x:9,y:10},{x:8,y:10}];
    dir = {x:1,y:0}; queuedDir = {x:1,y:0};
    food = spawnFood();
    score = 0; gameOver = false; hasStarted = false;
    acc = 0; lastTime = performance.now();
    setSpeed(parseInt(speedEl.value, 10));
    scoreEl.textContent = score;
    high = parseInt(localStorage.getItem('snake_high') || '0', 10);
    highEl.textContent = high;
    draw();
    drawBanner('Press W/A/S/D or Swipe to start');
    ensureRAF();
  }

  function spawnFood() {
    let pos;
    do {
      pos = { x: randInt(0, GRID-1), y: randInt(0, GRID-1) };
    } while (snake.some(s => s.x === pos.x && s.y === pos.y));
    return pos;
  }
  const randInt = (min,max)=>Math.floor(Math.random()*(max-min+1))+min;

  function queueDir(nx, ny) { if (!(nx===-dir.x && ny===-dir.y)) queuedDir = {x:nx,y:ny}; }
  function startIfNeeded() { if (!running && !gameOver) { hasStarted = true; start(); } }

  window.addEventListener('keydown', e => {
    const k = e.key.toLowerCase();
    if (k==='w'){queueDir(0,-1);startIfNeeded();}
    else if(k==='s'){queueDir(0,1);startIfNeeded();}
    else if(k==='a'){queueDir(-1,0);startIfNeeded();}
    else if(k==='d'){queueDir(1,0);startIfNeeded();}
    else if(k==='f'){togglePause();}
    else if(k==='r'){hardRestart();}
  });

  let touchStartX=0,touchStartY=0,touchActive=false,lastTapTime=0;
  const SWIPE_THRESH=24, DOUBLE_TAP_MS=300;
  board.addEventListener('touchstart',e=>{
    if(!e.touches.length)return;
    const t=e.touches[0];
    touchStartX=t.clientX;touchStartY=t.clientY;touchActive=true;
  },{passive:true});
  board.addEventListener('touchmove',e=>{if(touchActive)e.preventDefault();},{passive:false});
  board.addEventListener('touchend',e=>{
    if(!touchActive)return;touchActive=false;
    const t=e.changedTouches[0];const dx=t.clientX-touchStartX;const dy=t.clientY-touchStartY;
    const dist=Math.max(Math.abs(dx),Math.abs(dy));
    if(dist<SWIPE_THRESH){
      if(gameOver){hardRestart();return;}
      const now=performance.now();
      if(now-lastTapTime<DOUBLE_TAP_MS){hardRestart();}
      else{togglePause();}
      lastTapTime=now;return;
    }
    if(Math.abs(dx)>Math.abs(dy)){if(dx>0)queueDir(1,0);else queueDir(-1,0);}
    else{if(dy>0)queueDir(0,1);else queueDir(0,-1);}
    startIfNeeded();
  },{passive:true});

  speedEl.addEventListener('change',()=>setSpeed(parseInt(speedEl.value,10)));
  btnHelp.addEventListener('click',()=>helpDlg.showModal());
  btnCloseHelp.addEventListener('click',()=>helpDlg.close());
  helpDlg.addEventListener('cancel',e=>{e.preventDefault();helpDlg.close();});

  function ensureRAF(){if(!rafStarted){rafStarted=true;lastTime=performance.now();requestAnimationFrame(loop);}}
  function start(){running=true;gameOver=false;lastTime=performance.now();acc=0;}
  function togglePause(){if(gameOver||!hasStarted)return;running=!running;if(running){lastTime=performance.now();acc=0;}}
  function hardRestart(){reset(); hasStarted = true; start();}

  function loop(t){
    if(!lastTime)lastTime=t;
    const dt=t-lastTime;lastTime=t;
    if(running){acc+=dt;while(acc>=step){update();acc-=step;if(gameOver){running=false;break;}}}
    draw();
    if(!hasStarted&&!running&&!gameOver)drawBanner('Press W/A/S/D or Swipe to start');
    else if(gameOver)drawBanner('You are dead. Press R to restart or tap to restart.');
    else if(!running&&hasStarted&&!gameOver)drawBanner('Paused ‚Äî press F or tap to resume');
    requestAnimationFrame(loop);
  }

  function update(){
    dir=queuedDir;
    const head=snake[0],nx=head.x+dir.x,ny=head.y+dir.y;
    if(nx<0||ny<0||nx>=GRID||ny>=GRID){endGame();return;}
    if(snake.some((s,i)=>i>0&&s.x===nx&&s.y===ny)){endGame();return;}
    snake.unshift({x:nx,y:ny});
    if(nx===food.x&&ny===food.y){
      score++;scoreEl.textContent=score;
      if(score>high){high=score;highEl.textContent=high;localStorage.setItem('snake_high',String(high));}
      food=spawnFood();
    }else snake.pop();
  }

  function endGame(){gameOver=true;running=false;}
  function draw(){
    const side=TILE*GRID;ctx.fillStyle='#081021';ctx.fillRect(0,0,side,side);
    ctx.strokeStyle='rgba(255,255,255,0.045)';for(let i=1;i<GRID;i++){const p=i*TILE;ctx.beginPath();ctx.moveTo(p,0);ctx.lineTo(p,side);ctx.stroke();ctx.beginPath();ctx.moveTo(0,p);ctx.lineTo(side,p);ctx.stroke();}
    drawCell(food.x,food.y,FOOD_COLOR,Math.max(4,Math.floor(TILE*0.3)));
    snake.forEach((seg,idx)=>{const c=idx===0?HEAD_COLOR:SNAKE_COLOR;drawCell(seg.x,seg.y,c,idx===0?3:4);});
  }

  function drawCell(x,y,color,inset=4){
    const px=x*TILE,py=y*TILE;const w=TILE-2*inset,h=TILE-2*inset;ctx.fillStyle=color;
    const r=Math.max(2,Math.floor(TILE*0.25));roundRect(ctx,px+inset,py+inset,w,h,r);ctx.fill();
  }
  function roundRect(ctx,x,y,w,h,r){ctx.beginPath();ctx.moveTo(x+r,y);ctx.arcTo(x+w,y,x+w,y+h,r);ctx.arcTo(x+w,y+h,x,y+h,r);ctx.arcTo(x,y+h,x,y,r);ctx.arcTo(x,y,x+w,y,r);ctx.closePath();}
  function drawBanner(text){
    const side=TILE*GRID;ctx.save();ctx.fillStyle='rgba(0,0,0,0.45)';
    const barH=Math.max(48,Math.floor(side*0.18));ctx.fillRect(0,(side-barH)/2,side,barH);
    ctx.fillStyle='#e5e7eb';ctx.font=`${Math.max(14,Math.floor(side*0.045))}px system-ui, sans-serif`;
    ctx.textAlign='center';ctx.textBaseline='middle';wrapText(ctx,text,side/2,side/2,Math.floor(side*0.84),Math.max(16,Math.floor(side*0.05)));ctx.restore();
  }
  function wrapText(ctx,text,x,y,maxWidth,lineHeight){
    const words=text.split(' ');let line='',lines=[];for(let w of words){const test=line?(line+' '+w):w;if(ctx.measureText(test).width>maxWidth&&line){lines.push(line);line=w;}else line=test;}
    if(line)lines.push(line);const startY=y-((lines.length-1)*lineHeight)/2;lines.forEach((ln,i)=>ctx.fillText(ln,x,startY+i*lineHeight));
  }
  function getCSS(v){return getComputedStyle(document.documentElement).getPropertyValue(v).trim();}

  reset();
})();
</script>
</body>
</html>
